<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using r2d3 with Shiny • r2d3</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Using r2d3 with Shiny">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">r2d3</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Using</li>
    <li>
      <a href="../articles/introduction.html">Introduction to r2d3</a>
    </li>
    <li>
      <a href="../articles/data_conversion.html">R to D3 Data Conversion</a>
    </li>
    <li>
      <a href="../articles/visualization_options.html">D3 Visualization Options</a>
    </li>
    <li>
      <a href="../articles/development_and_debugging.html">Development and Debugging</a>
    </li>
    <li>
      <a href="../articles/publishing.html">Publishing D3 Visualizations</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Advanced</li>
    <li>
      <a href="../articles/shiny.html">Using r2d3 with Shiny</a>
    </li>
    <li>
      <a href="../articles/dependencies.html">CSS and JavaScript Dependencies </a>
    </li>
    <li>
      <a href="../articles/advanced_rendering.html">Advanced Rendering with Callbacks</a>
    </li>
    <li>
      <a href="../articles/package_development.html">Package Development</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/learning_d3.html">Learning D3</a>
</li>
<li>
  <a href="../articles/gallery.html">Gallery</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rstudio/r2d3">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Using r2d3 with Shiny</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/r2d3/blob/master/vignettes/shiny.Rmd"><code>vignettes/shiny.Rmd</code></a></small>
      <div class="hidden name"><code>shiny.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>Integrating Shiny and D3 can be a powerful combination. Deriving insights from data is streamlined when users are able to modify a Shiny input, or click on a D3 visualization, and that action produces new results.</p>
<p>There are two ways that D3 visualizations can be integrated with Shiny. The difference has to do with the direction of the communication:</p>
<ol style="list-style-type: decimal">
<li><p>From <strong>Shiny</strong> to <strong>D3</strong></p></li>
<li><p>From <strong>D3</strong> to <strong>Shiny</strong></p></li>
</ol>
</div>
<div id="shiny-to-d3" class="section level2">
<h2 class="hasAnchor">
<a href="#shiny-to-d3" class="anchor"></a>Shiny to D3</h2>
<p>When going from Shiny to D3, users make changes to Shiny inputs which result in changes to the D3 visualization. The <code>r2d3</code> package provides two functions that enables this functionality:</p>
<ol style="list-style-type: decimal">
<li>
<p><code><a href="../reference/d3-shiny.html">renderD3()</a></code> - Works just like <code><a href="http://www.rdocumentation.org/packages/shiny/topics/renderPlot">renderPlot()</a></code>, it creates a reactive D3 plot that can be used as an <code>output</code>. <code><a href="../reference/d3-shiny.html">renderD3()</a></code> is used server-side (<code>server</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">server &lt;-<span class="st"> </span>function(input, output) {
  output$d3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/d3-shiny.html">renderD3</a></span>({...})
}</code></pre></div>
</li>
<li>
<p><code><a href="../reference/d3-shiny.html">d3Output()</a></code> - Akin to <code><a href="http://www.rdocumentation.org/packages/shiny/topics/plotOutput">plotOutput()</a></code>, it is used client-side (<code>ui</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(
  <span class="kw"><a href="../reference/d3-shiny.html">d3Output</a></span>(<span class="st">"d3"</span>)
)</code></pre></div>
</li>
</ol>
<div id="example" class="section level3">
<h3 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h3>
<p>This example shows a Shiny app that modifies a D3 plot’s bar length based on the value that the user chooses for the <code><a href="http://www.rdocumentation.org/packages/shiny/topics/sliderInput">sliderInput()</a></code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shiny)
<span class="kw">library</span>(r2d3)

ui &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/fluidPage">fluidPage</a></span>(
  <span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/inputPanel">inputPanel</a></span>(
    <span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/sliderInput">sliderInput</a></span>(<span class="st">"bar_max"</span>, <span class="dt">label =</span> <span class="st">"Max:"</span>,
      <span class="dt">min =</span> <span class="dv">10</span>, <span class="dt">max =</span> <span class="dv">110</span>, <span class="dt">value =</span> <span class="dv">10</span>, <span class="dt">step =</span> <span class="dv">20</span>)
  ),
  <span class="kw"><a href="../reference/d3-shiny.html">d3Output</a></span>(<span class="st">"d3"</span>)
)

server &lt;-<span class="st"> </span>function(input, output) {
  output$d3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/d3-shiny.html">renderD3</a></span>({
    <span class="kw"><a href="../reference/r2d3.html">r2d3</a></span>(
      <span class="kw">floor</span>(<span class="kw">runif</span>(<span class="dv">5</span>, <span class="dv">5</span>, input$bar_max)),
      <span class="dt">script =</span> <span class="kw">system.file</span>(<span class="st">"examples/baranims.js"</span>, <span class="dt">package =</span> <span class="st">"r2d3"</span>)
    )
  })
}

<span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/shinyApp">shinyApp</a></span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</code></pre></div>
<p>And here is the app in action:</p>
<p><img src="images/baranim-1.gif" class="illustration" width="600/"></p>
</div>
</div>
<div id="d3-to-shiny" class="section level2">
<h2 class="hasAnchor">
<a href="#d3-to-shiny" class="anchor"></a>D3 to Shiny</h2>
<p>Having a D3 plot update based on a changing Shiny input is very common. But, what about having an action that happened inside a D3 plot trigger something in Shiny?</p>
<p>For example, we may want Shiny to know that our D3 bar plot was clicked on, and know which bar was clicked. Enabling communication from D3 to Shiny requires changes to both D3 and Shiny code:</p>
<ul>
<li>
<em>D3 script</em> - Add a call to the Shiny JavaScript function <code>Shiny.onInputChange()</code>.</li>
<li>
<em>Shiny script</em> - Add a reactive function that looks for the change and performs an action based on the selected value.</li>
</ul>
<div id="example-1" class="section level3">
<h3 class="hasAnchor">
<a href="#example-1" class="anchor"></a>Example</h3>
<p>In this example, the bar plot will pass to Shiny the data value of the bar that the user clicked on. Shiny will then display the cosine of the value.</p>
<div id="d3-code" class="section level4">
<h4 class="hasAnchor">
<a href="#d3-code" class="anchor"></a>D3 Code</h4>
<p>Here is the D3 script:</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="co">// !preview r2d3 data=c(0.3, 0.6, 0.8, 0.95, 0.40, 0.20)</span>

<span class="kw">var</span> barHeight <span class="op">=</span> <span class="va">Math</span>.<span class="at">ceil</span>(height / <span class="va">data</span>.<span class="at">length</span>)<span class="op">;</span>

<span class="va">svg</span>.<span class="at">selectAll</span>(<span class="st">'rect'</span>)
  .<span class="at">data</span>(data)
  .<span class="at">enter</span>().<span class="at">append</span>(<span class="st">'rect'</span>)
    .<span class="at">attr</span>(<span class="st">'width'</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> d <span class="op">*</span> width<span class="op">;</span> <span class="op">}</span>)
    .<span class="at">attr</span>(<span class="st">'height'</span><span class="op">,</span> barHeight)
    .<span class="at">attr</span>(<span class="st">'y'</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) <span class="op">{</span> <span class="cf">return</span> i <span class="op">*</span> barHeight<span class="op">;</span> <span class="op">}</span>)
    .<span class="at">attr</span>(<span class="st">'fill'</span><span class="op">,</span> <span class="st">'steelblue'</span>)
    .<span class="at">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> d<span class="op">;</span> <span class="op">}</span>)
    .<span class="at">on</span>(<span class="st">"click"</span><span class="op">,</span> <span class="kw">function</span>()<span class="op">{</span>
      <span class="va">Shiny</span>.<span class="at">onInputChange</span>(
        <span class="st">"bar_clicked"</span><span class="op">,</span> 
        <span class="va">d3</span>.<span class="at">select</span>(<span class="kw">this</span>).<span class="at">attr</span>(<span class="st">"d"</span>))<span class="op">;</span>
    <span class="op">}</span>)<span class="op">;</span></code></pre></div>
<p>First, we need to decide which attribute (<code>.attr</code>) is going to be passed to Shiny when the user clicks. Any existing attribute can be passed, such as the value of <code>y</code> or <code>width</code>, but because no current attribute contain the raw value of the data, a new made up attribute is added, we called it <code>d</code>. The <code>d</code> attribute is set to rerun the <code>d</code> variable.</p>
<p><img src="images/attr.PNG" class="illustration" width="600/"></p>
<p>Next, the <code>on()</code> function is used to capture an event inside the plot.The first argument is <em>“click”</em>, indicating that we want it to be activated when someone clicks on the plot. The second argument of <code>on()</code> is a function, this function will contain a call to the <code>Shiny.onInputChange()</code> JS function. The first argument of the Shiny JS function is the name that the Shiny app will be looking for. In this case, we will use <strong>bar_clicked</strong>. The second argument is the value that is returned to Shiny, and for that, we will use the <code>d</code> attribute created previously.</p>
<p><img src="images/onclick.PNG" class="illustration" width="600/"></p>
</div>
<div id="shiny-code" class="section level4">
<h4 class="hasAnchor">
<a href="#shiny-code" class="anchor"></a>Shiny Code</h4>
<p>Here’s the code for the Shiny application that interacts with D3:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ui &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/fluidPage">fluidPage</a></span>(
  <span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/verbatimTextOutput">verbatimTextOutput</a></span>(<span class="st">"selected"</span>),
  <span class="kw"><a href="../reference/d3-shiny.html">d3Output</a></span>(<span class="st">"d3"</span>)
)

server &lt;-<span class="st"> </span>function(input, output) {
  output$d3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/d3-shiny.html">renderD3</a></span>({
    <span class="kw"><a href="../reference/r2d3.html">r2d3</a></span>(
      <span class="kw">c</span>(<span class="fl">0.3</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.95</span>, <span class="fl">0.40</span>),
      <span class="dt">script =</span> <span class="st">"bar.js"</span>
    )
  })
  output$selected &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/renderText">renderText</a></span>({
    bar_number &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/req">req</a></span>(input$bar_clicked))
    if(bar_number &gt;<span class="st"> </span><span class="dv">0</span>) <span class="kw">cos</span>(bar_number) 
  })
}

<span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/shinyApp">shinyApp</a></span>(ui, server)</code></pre></div>
<p>The <code>ui</code> contains a text output named <code>selected</code>. Server-side, a reactive function, called <code>output$selected()</code> will used to capture the changes of the bar selection.</p>
<p>In the D3 script, we called <code>Shiny.onInputChanged()</code> with an input named <code>bar_clicked</code>. This can now be used as if was an Shiny <code>input</code> in the app. In this case, the name to track will be: <code>input$bar_clicked</code>.</p>
<p>The <code>output$selected()</code> function uses <code><a href="http://www.rdocumentation.org/packages/shiny/topics/renderText">renderText()</a></code> to display the cosine of the bar that was clicked on. The call to <code>input$bar_clicked</code> is used inside <code><a href="http://www.rdocumentation.org/packages/shiny/topics/renderText">renderText()</a></code> to execute the <code>cos()</code> calculation.</p>
<p>The default value of <code>input$bar_clicked</code> will be <code>NULL</code> at the startup of the app. In this state you won’t want to perform any calculation (as it would result in an error) or display any output. Shiny’s <code><a href="http://www.rdocumentation.org/packages/shiny/topics/req">req()</a></code> function can be used to prevent errors in this case <code><a href="http://www.rdocumentation.org/packages/shiny/topics/req">req()</a></code> stops reactivity if the value of the variable passed as an argument is not valid, read more about this function in Shiny’s official site: <a href="http://shiny.rstudio.com/reference/shiny/latest/req.html">Check for required values</a></p>
<p>Here is the Shiny application in action:</p>
<p><img src="images/d3toshiny.gif" class="illustration" width="600/"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#shiny-to-d3">Shiny to D3</a></li>
      <li><a href="#d3-to-shiny">D3 to Shiny</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Javier Luraschi, JJ Allaire.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
