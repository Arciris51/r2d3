<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Rendering with Callbacks • r2d3</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Advanced Rendering with Callbacks">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">r2d3</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Using</li>
    <li>
      <a href="../articles/data_conversion.html">R to D3 Data Conversion</a>
    </li>
    <li>
      <a href="../articles/visualization_options.html">D3 Visualization Options</a>
    </li>
    <li>
      <a href="../articles/development_and_debugging.html">Development and Debugging</a>
    </li>
    <li>
      <a href="../articles/publishing.html">Publishing D3 Visualizations</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Advanced</li>
    <li>
      <a href="../articles/dependencies.html">CSS and JavaScript Dependencies </a>
    </li>
    <li>
      <a href="../articles/advanced_rendering.html">Advanced Rendering with Callbacks</a>
    </li>
    <li>
      <a href="../articles/package_development.html">Package Development</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/gallery/bubbles/">Gallery</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rstudio/r2d3">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Advanced Rendering with Callbacks</h1>
            
      
      <small>Source: <a href="https://github.com/rstudio/r2d3/blob/master/vignettes/advanced_rendering.Rmd"><code>vignettes/advanced_rendering.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>By default, D3 visualizations created with <strong>r2d3</strong> are monolithic scripts that do all of their work as a single computation (the body of the script). While this makes scripts straightforward to author by default, not all visualizations will confirm to this simple model. Rather, some visualizations will want to distinguish between the following activities:</p>
<ol style="list-style-type: decimal">
<li><p>Code that performs one-time initialization for the visualization (e.g. creation of a D3 layout).</p></li>
<li><p>Code that runs whenever the data underlying the visualization is changed.</p></li>
<li><p>Code that runs whenever the visualizations container element is resized.</p></li>
</ol>
<p>This article describes how you can use the <strong>r2d3</strong> advanced rendering API to organize your visualization code to run in this more granular fashion.</p>
</div>
<div id="onrender-callback" class="section level2">
<h2 class="hasAnchor">
<a href="#onrender-callback" class="anchor"></a>onRender Callback</h2>
<p>To distinguish between code that runs at initialization-time only and code that runs when data changes, organize your code so that the code which responds to data changes is contained within the <code>r2d3.onRender()</code> callback. For example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">// Initialization</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">svg</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"> .<span class="at">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"> .<span class="at">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"8"</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"> .<span class="at">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">    </a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">var</span> pack <span class="op">=</span> <span class="va">d3</span>.<span class="at">pack</span>()</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">  .<span class="at">size</span>([width<span class="op">,</span> height])</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">  .<span class="at">padding</span>(<span class="fl">1.5</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">    </a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw">var</span> format <span class="op">=</span> <span class="va">d3</span>.<span class="at">format</span>(<span class="st">",d"</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw">var</span> color <span class="op">=</span> <span class="va">d3</span>.<span class="at">scaleOrdinal</span>(<span class="va">d3</span>.<span class="at">schemeCategory20c</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">// Rendering</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="va">r2d3</span>.<span class="at">onRender</span>(<span class="kw">function</span>(data<span class="op">,</span> svg<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> options) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16">  <span class="kw">var</span> root <span class="op">=</span> <span class="va">d3</span>.<span class="at">hierarchy</span>(<span class="op">{</span><span class="dt">children</span><span class="op">:</span> data<span class="op">}</span>)</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">    .<span class="at">sum</span>(<span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="va">d</span>.<span class="at">value</span><span class="op">;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">    .<span class="at">each</span>(<span class="kw">function</span>(d) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19">      <span class="cf">if</span> (id <span class="op">=</span> <span class="va">d</span>.<span class="va">data</span>.<span class="at">id</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20">        <span class="kw">var</span> id<span class="op">,</span> i <span class="op">=</span> <span class="va">id</span>.<span class="at">lastIndexOf</span>(<span class="st">"."</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21">        <span class="va">d</span>.<span class="at">id</span> <span class="op">=</span> id<span class="op">;</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22">        <span class="va">d</span>.<span class="at">package</span> <span class="op">=</span> <span class="va">id</span>.<span class="at">slice</span>(<span class="dv">0</span><span class="op">,</span> i)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23">        <span class="va">d</span>.<span class="at">class</span> <span class="op">=</span> <span class="va">id</span>.<span class="at">slice</span>(i <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24">      <span class="op">}</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"></a>
<a class="sourceLine" id="cb1-27" data-line-number="27">  <span class="kw">var</span> node <span class="op">=</span> <span class="va">svg</span>.<span class="at">selectAll</span>(<span class="st">".node"</span>)</a>
<a class="sourceLine" id="cb1-28" data-line-number="28">    .<span class="at">data</span>(<span class="at">pack</span>(root).<span class="at">leaves</span>())</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">    .<span class="at">enter</span>().<span class="at">append</span>(<span class="st">"g"</span>)</a>
<a class="sourceLine" id="cb1-30" data-line-number="30">      .<span class="at">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"node"</span>)</a>
<a class="sourceLine" id="cb1-31" data-line-number="31">      .<span class="at">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="st">"translate("</span> <span class="op">+</span> <span class="va">d</span>.<span class="at">x</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> <span class="va">d</span>.<span class="at">y</span> <span class="op">+</span> <span class="st">")"</span><span class="op">;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-32" data-line-number="32"></a>
<a class="sourceLine" id="cb1-33" data-line-number="33">  <span class="va">node</span>.<span class="at">append</span>(<span class="st">"circle"</span>)</a>
<a class="sourceLine" id="cb1-34" data-line-number="34">      .<span class="at">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="va">d</span>.<span class="at">id</span><span class="op">;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb1-35" data-line-number="35">      .<span class="at">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="va">d</span>.<span class="at">r</span><span class="op">;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb1-36" data-line-number="36">      .<span class="at">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="at">color</span>(<span class="va">d</span>.<span class="at">package</span>)<span class="op">;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-37" data-line-number="37"></a>
<a class="sourceLine" id="cb1-38" data-line-number="38">  <span class="va">node</span>.<span class="at">append</span>(<span class="st">"clipPath"</span>)</a>
<a class="sourceLine" id="cb1-39" data-line-number="39">      .<span class="at">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="st">"clip-"</span> <span class="op">+</span> <span class="va">d</span>.<span class="at">id</span><span class="op">;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb1-40" data-line-number="40">    .<span class="at">append</span>(<span class="st">"use"</span>)</a>
<a class="sourceLine" id="cb1-41" data-line-number="41">      .<span class="at">attr</span>(<span class="st">"xlink:href"</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="st">"#"</span> <span class="op">+</span> <span class="va">d</span>.<span class="at">id</span><span class="op">;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-42" data-line-number="42"></a>
<a class="sourceLine" id="cb1-43" data-line-number="43">  <span class="va">node</span>.<span class="at">append</span>(<span class="st">"text"</span>)</a>
<a class="sourceLine" id="cb1-44" data-line-number="44">      .<span class="at">attr</span>(<span class="st">"clip-path"</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="st">"url(#clip-"</span> <span class="op">+</span> <span class="va">d</span>.<span class="at">id</span> <span class="op">+</span> <span class="st">")"</span><span class="op">;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb1-45" data-line-number="45">    .<span class="at">selectAll</span>(<span class="st">"tspan"</span>)</a>
<a class="sourceLine" id="cb1-46" data-line-number="46">    .<span class="at">data</span>(<span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="va">d</span>.<span class="va">class</span>.<span class="at">split</span>(<span class="ss">/</span><span class="sc">(?</span><span class="ss">=</span><span class="sc">[A-Z][^A-Z])</span><span class="ss">/g</span>)<span class="op">;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb1-47" data-line-number="47">    .<span class="at">enter</span>().<span class="at">append</span>(<span class="st">"tspan"</span>)</a>
<a class="sourceLine" id="cb1-48" data-line-number="48">      .<span class="at">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-49" data-line-number="49">      .<span class="at">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i<span class="op">,</span> nodes) <span class="op">{</span> <span class="cf">return</span> <span class="dv">13</span> <span class="op">+</span> (i <span class="op">-</span> <span class="va">nodes</span>.<span class="at">length</span> / <span class="dv">2</span> <span class="op">-</span> <span class="fl">0.5</span>) <span class="op">*</span> <span class="dv">10</span><span class="op">;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb1-50" data-line-number="50">      .<span class="at">text</span>(<span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> d<span class="op">;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-51" data-line-number="51"></a>
<a class="sourceLine" id="cb1-52" data-line-number="52">  <span class="va">node</span>.<span class="at">append</span>(<span class="st">"title"</span>)</a>
<a class="sourceLine" id="cb1-53" data-line-number="53">      .<span class="at">text</span>(<span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="va">d</span>.<span class="at">id</span> <span class="op">+</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span> <span class="op">+</span> <span class="at">format</span>(<span class="va">d</span>.<span class="at">value</span>)<span class="op">;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-54" data-line-number="54"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
</div>
<div id="onresize-callback" class="section level2">
<h2 class="hasAnchor">
<a href="#onresize-callback" class="anchor"></a>onResize Callback</h2>
<p>By default, when the element which contains your visualization is resized, <strong>r2d3</strong> will call back your script to re-render the visualization from scratch using the new size. In some cases this might be acceptable, but in other cases it makes sense to have code which explicitly handles the resize in a more efficient fashion.</p>
<p>You can provide an explicit resize handler by implementing the <code>r2d3.onResize()</code> callback. For example, in a force directed D3 layout you might do this in the <code>onResize()</code> callback:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="va">r2d3</span>.<span class="at">onResize</span>(width<span class="op">,</span> height) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="va">force</span>.<span class="at">force</span>(<span class="st">"center"</span><span class="op">,</span> <span class="va">d3</span>.<span class="at">forceCenter</span>(width / <span class="dv">2</span><span class="op">,</span> height / <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    .<span class="at">restart</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="op">}</span></a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#onrender-callback">onRender Callback</a></li>
      <li><a href="#onresize-callback">onResize Callback</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Javier Luraschi, JJ Allaire.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
